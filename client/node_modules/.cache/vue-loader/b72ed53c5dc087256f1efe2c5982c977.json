{"remainingRequest":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\src\\components\\GenealogyPage.vue?vue&type=style&index=0&id=e29c9c60&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\src\\components\\GenealogyPage.vue","mtime":1640167737626},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\css-loader\\dist\\cjs.js","mtime":1640165329170},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1640165341319},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\postcss-loader\\src\\index.js","mtime":1640165336647},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1640165339627},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1640165327016},{"path":"C:\\Users\\Laggy pc\\Documents\\GitHub\\SoftwareEngineeringB11\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":1640165341316}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCiNhcHAgew0KICBmb250LWZhbWlseTogQXZlbmlyLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOw0KICAtd2Via2l0LWZvbnQtc21vb3RoaW5nOiBhbnRpYWxpYXNlZDsNCiAgLW1vei1vc3gtZm9udC1zbW9vdGhpbmc6IGdyYXlzY2FsZTsNCiAgY29sb3I6ICMyYzNlNTA7DQogIG1hcmdpbi10b3A6IDMwcHg7DQp9DQoudGV4dC1jZW50ZXIgew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIG1hcmdpbi1ib3R0b206IDE2cHg7DQp9DQouY3VzdG9tLWNhcmQgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBtaW4td2lkdGg6IDExMHB4Ow0KICBoZWlnaHQ6IDU1cHg7DQogIHBhZGRpbmc6IDVweDsNCiAgYm9yZGVyOiAwLjVweCBzb2xpZCAjZGRkOw0KICBib3JkZXItcmFkaXVzOiA1cHg7DQogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgYm94LXNoYWRvdzogMCAwIDNweCAxcHggcmdiYSgjMDAwLCAwKTsNCiAgdHJhbnNpdGlvbjogYm94LXNoYWRvdyAuMnMgZWFzZTsNCiAgJjpob3ZlciB7DQogICAgYm94LXNoYWRvdzogMCAwIDNweCAxcHggcmdiYSgjMDAwLCAuMSk7DQogIH0NCiAgJl9faW1hZ2Ugew0KICAgIGZsZXg6IDAgMCBhdXRvOw0KICAgIHdpZHRoOiAzMHB4Ow0KICAgIGhlaWdodDogMzBweDsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2RlZGVkZTsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOw0KICAgIGJhY2tncm91bmQtcG9zaXRpb246IDUwJTsNCiAgfQ0KICAmX19pbmZvIHsNCiAgICBwYWRkaW5nLWxlZnQ6IDhweDsNCiAgfQ0KICAmX19uYW1lIHsNCiAgICBmb250LXdlaWdodDogMzAwOw0KICB9DQogICZfX2FnZSB7DQogICAgbWFyZ2luLXRvcDogMnB4Ow0KICAgIGZvbnQtc2l6ZTogNnB4Ow0KICB9DQp9DQo="},{"version":3,"sources":["GenealogyPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"GenealogyPage.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div id=\"app\">\r\n    <el-card>\r\n<<<<<<< HEAD\r\n=======\r\n            <div><el-button type=\"primary\" icon=\"el-icon-check\" @click=\"saveGenealogy\">保存家谱</el-button>\r\n        <el-button type=\"danger\" icon=\"el-icon-refresh-right\" @click=\"clearGenealogy\">重置家谱</el-button>\r\n<!--      <span v-if=\"saving\">saving....</span>-->\r\n              <i style=\"margin-left: 20px;margin-right: 5px\" class=\"el-icon-loading\" v-if=\"saving\"></i>\r\n      <span  v-if=\"saving\" >保存中....</span>\r\n      </div>\r\n      <i style=\"margin-left: 50px;margin-top: 30px;margin-bottom: 30px\" class=\"el-icon-loading\" v-if=\"loading\"></i>\r\n      <span  v-if=\"loading\" >加载中....</span>\r\n\r\n<!--      <el-button @click=\"outputUsedtable\">test</el-button>-->\r\n>>>>>>> 07afd30c... Add files via upload\r\n<!--    <div class=\"text-center\">-->\r\n<!--&lt;!&ndash;      <h1 class=\"title\">家谱</h1>&ndash;&gt;-->\r\n<!--    </div>-->\r\n    <VueFamilyTree\r\n      :tree=\"tree\"\r\n      @card-click=\"cardClick\"\r\n    >\r\n      <template\r\n        v-if=\"customCard\"\r\n        v-slot:card=\"{item}\"\r\n      >\r\n        <el-popover\r\n  placement=\"right\"\r\n  width=\"100\"\r\n  trigger=\"click\">\r\n  <el-menu :default-openeds=\"['2']\">\r\n    <el-popover\r\n  placement=\"right\"\r\n  width=\"100\"\r\n  trigger=\"click\">\r\n      <el-menu :default-openeds=\"['3']\">\r\n        <div v-if=\"item.defined\">\r\n        <el-menu-item index=\"2-1\" @click=\"addMember(item,'Sibling')\">兄弟</el-menu-item>\r\n        <el-menu-item index=\"2-2\" @click=\"addMember(item,'Children')\">儿女</el-menu-item>\r\n        <el-menu-item index=\"2-3\" @click=\"addMember(item,'Honey')\">配偶</el-menu-item>\r\n          </div>\r\n        <div v-else v-for=\"user in userlist\" :key=\"user.id\">\r\n<el-menu-item index=\"4-1\" v-if=\"user.used===false\" @click=\"item.id=user.id;\r\n          item.defined=true;item.name=user.username;item.image='https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png';user.used = true;usedtable.push(user.id);this.$forceUpdate;\">{{user.username}}</el-menu-item>\r\n        </div>\r\n      </el-menu>\r\n    <el-menu-item  v-if=\"item.defined\" slot=\"reference\" index=\"3-2\">添加成员</el-menu-item>\r\n      <el-menu-item  v-if=\"!item.defined\" slot=\"reference\" index=\"3-3\">选择成员</el-menu-item>\r\n    </el-popover>\r\n    <el-menu-item  v-if=\"!item.defined\"\r\n                     index=\"3-4\"\r\n     @click=\"customizeName(item);\r\n            \">自定义成员</el-menu-item>\r\n    <el-menu-item index=\"2-4\" style=\"color: #dc0606\" @click=\"addMember(item,'Delete')\">删除</el-menu-item>\r\n  </el-menu>\r\n        <div slot=\"reference\" class=\"custom-card\"  @click=\"cardClick(item)\">\r\n          <div\r\n            :style=\"{backgroundImage: item.image ? `url(${item.image})` :  null}\"\r\n            class=\"custom-card__image\"\r\n          />\r\n          <div class=\"custom-card__info\">\r\n            <div class=\"custom-card__name\">\r\n              {{ item.name }}\r\n            </div>\r\n            <div\r\n              v-show=\"item.age\"\r\n              class=\"custom-card__age\"\r\n            >\r\n              Age: {{ item.age }}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        </el-popover>\r\n      </template>\r\n    </VueFamilyTree>\r\n      </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VueFamilyTree from 'vue-family-tree';\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  name: 'App',\r\n  components: {\r\n    VueFamilyTree,\r\n  },\r\n  props: {\r\n    // eslint-disable-next-line vue/require-prop-type-constructor\r\n    info: {},\r\n  },\r\n  data() {\r\n    return {\r\n      saving: false,\r\n      loading: true,\r\n      customCard: true,\r\n      usedtable: [],\r\n      seeable: false,\r\n      userlist: [],\r\n      nameinput: '',\r\n      randomnum: 0,\r\n      temptree: [],\r\n      currentchildren: [],\r\n      currentnode: {},\r\n      minus: -1,\r\n      uppertree: [],\r\n      tree: [{\r\n        firstPerson: {\r\n          name: '未定义',\r\n          image: 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png',\r\n          id: -1,\r\n          defined: false,\r\n          used: false,\r\n          root: true,\r\n        },\r\n      }],\r\n    };\r\n  },\r\n  methods: {\r\n    cardClick(item) {\r\n      console.log(item);\r\n      console.log(this.tree);\r\n    },\r\n    // 添加成员\r\n    addMember(item, type) {\r\n      console.log(item);\r\n      this.test(this.tree, item.id); // 返回选中节点和层的信息\r\n      console.log(this.currentchildren);\r\n      if (type === 'Sibling') {\r\n        if (item.root === true) {\r\n          this.$message({\r\n            type: 'warning',\r\n            message: '根无法添加兄弟',\r\n          });\r\n        } else {\r\n          console.log('addSibling');\r\n          // eslint-disable-next-line no-restricted-syntax\r\n          const ele = { firstPerson: { name: '未定义', id: this.minus, image: 's' } };\r\n          this.minus -= 1;\r\n          this.currentchildren.push(ele);\r\n        }\r\n      } else if (type === 'Children') {\r\n        const ele = { firstPerson: { name: '未定义', id: this.minus, image: 's' } };\r\n        this.minus -= 1;\r\n        if (this.currentnode.children !== undefined) {\r\n          this.currentnode.children.push(ele);\r\n        } else {\r\n          // eslint-disable-next-line no-param-reassign\r\n          this.currentnode.children = [];\r\n          this.currentnode.children.push(ele);\r\n        }\r\n        console.log('addChildren');\r\n      } else if (type === 'Honey') {\r\n        const ele = { name: '未定义', id: this.minus, image: 's' };\r\n        this.minus -= 1;\r\n        if (this.currentnode.firstPerson !== undefined && this.currentnode.secondPerson === undefined) { // 说明只有左节点\r\n          this.currentnode.secondPerson = ele;\r\n          this.testnum += 1;\r\n        } else if (this.currentnode.firstPerson === undefined && this.currentnode.secondPerson !== undefined) { // 说明只有右节点\r\n          this.currentnode.firstPerson = ele;\r\n        } else { // 说明两个节点都有\r\n          this.$message({\r\n            type: 'warning',\r\n            message: '无法添加配偶',\r\n          });\r\n        }\r\n        console.log('addHoney');\r\n      } else if (type === 'Delete') {\r\n        if (item.root === true) {\r\n          this.$message({\r\n            type: 'warning',\r\n            message: '根元素无法删除！',\r\n          });\r\n        } else {\r\n          // eslint-disable-next-line no-unused-vars\r\n          this.test(this.currentchildren, item.id, 'Delete', true);\r\n          // const ttemp = [];\r\n          // ttemp.push(this.currentchildren);\r\n          // ttemp.splice(0, 1);\r\n          // delete this.currentchildren;\r\n          // eslint-disable-next-line no-plusplus\r\n          for (let i = 0; i < this.uppertree.length; ++i) {\r\n            if (this.uppertree[i].firstPerson !== undefined && this.uppertree[i].firstPerson.id === item.id) {\r\n              this.uppertree.splice(i, 1);\r\n            } else if (this.uppertree[i].secondPerson !== undefined && this.uppertree[i].secondPerson.id === item.id) {\r\n              this.uppertree.splice(i, 1);\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        console.log('Error');\r\n      }\r\n    },\r\n    // 递归遍历所有节点，根据id找到对应的children数组和节点\r\n    test(tree, id, type, first) {\r\n      this.$forceUpdate();\r\n      let e;\r\n      this.temptree = tree;\r\n      // eslint-disable-next-line guard-for-in,no-restricted-syntax\r\n      for (e of this.temptree) {\r\n        if (type === 'Delete') {\r\n          if (e.firstPerson !== undefined) {\r\n            if (!first) {\r\n              this.usedtable.splice(this.usedtable.indexOf(e.firstPerson.id), 1);\r\n            } else if (first) {\r\n              this.usedtable.splice(this.usedtable.indexOf(id), 1);\r\n            }\r\n          }\r\n          if (e.secondPerson !== undefined) {\r\n            if (!first) {\r\n              this.usedtable.splice(this.usedtable.indexOf(e.secondPerson.id), 1);\r\n            } else if (first) {\r\n              this.usedtable.splice(this.usedtable.indexOf(id), 1);\r\n            }\r\n          }\r\n          // eslint-disable-next-line no-restricted-syntax\r\n          for (const user of this.userlist) {\r\n            if (e.firstPerson !== undefined) {\r\n              if (!first) {\r\n                if (user.id === e.firstPerson.id) {\r\n                  user.used = false;\r\n                }\r\n              } else if (first) {\r\n                if (user.id === id) {\r\n                  user.used = false;\r\n                }\r\n              }\r\n            }\r\n            if (e.secondPerson !== undefined) {\r\n              if (!first) {\r\n                if (user.id === e.secondPerson.id) {\r\n                  user.used = false;\r\n                }\r\n              } else if (first) {\r\n                if (user.id === id) {\r\n                  user.used = false;\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (e.firstPerson !== undefined && e.firstPerson.id === id) {\r\n          this.currentnode = e;// 当前节点，字典类型\r\n          this.currentchildren = this.temptree; // 当前层，数组类型\r\n          this.uppertree = this.temptree;\r\n        }\r\n        if (e.secondPerson !== undefined && e.secondPerson.id === id) {\r\n          this.currentnode = e; // 当前节点，字典类型\r\n          this.currentchildren = this.temptree; // 当前层，数组类型\r\n          this.uppertree = this.temptree; // 总是返回上一层children数组\r\n        }\r\n        if (e.children !== undefined) { // 若它不是叶子结点\r\n          if (type === 'Delete') {\r\n            this.test(e.children, id, 'Delete', false);\r\n          } else {\r\n            this.test(e.children, id, false);\r\n          } // 递归至下一个孩子层\r\n        }\r\n      }\r\n      this.$forceUpdate();\r\n    },\r\n    clearGenealogy() {\r\n      this.tree = [{\r\n        firstPerson: {\r\n          name: '未定义',\r\n          image: 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png',\r\n          id: -1,\r\n          defined: false,\r\n          used: false,\r\n          root: true,\r\n        },\r\n      }];\r\n      // eslint-disable-next-line no-restricted-syntax\r\n      for (const user of this.userlist) {\r\n        user.used = false;\r\n      }\r\n      this.usedtable = [];\r\n      this.minus = -2;\r\n    },\r\n    saveGenealogy() {\r\n      this.saving = true;\r\n      const temp = {};\r\n      temp.tree = this.tree;\r\n      temp.usedtable = this.usedtable;\r\n      temp.minus = this.minus;\r\n      axios.post('/api/save-genealogy', { group_id: this.$props.info.id, content: temp })\r\n        .then((res) => {\r\n          this.saving = false;\r\n          if (res.data.status) {\r\n            console.log(res.data.message);\r\n          }\r\n          this.$message({\r\n            type: 'success',\r\n            message: '家谱保存成功',\r\n          });\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    loadGenealogy() {\r\n      this.loading = true;\r\n      axios.post('/api/query-genealogy', { group_id: this.$props.info.id })\r\n        .then((res) => {\r\n          if (res.data.status) {\r\n            console.log(res.data.message);\r\n            this.tree = res.data.content.tree;\r\n            this.usedtable = res.data.content.usedtable;\r\n            this.minus = res.data.content.minus;\r\n            this.loading = false;\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n      this.loading = true;\r\n      axios.post('/api/query-user', { group_id: this.$props.info.id })\r\n        .then((res) => {\r\n          this.loading = false;\r\n          if (res.data.status) {\r\n            this.$data.userlist = res.data.user_list;\r\n            // eslint-disable-next-line no-restricted-syntax\r\n            for (const user of this.userlist) { // 判断用户有没有已被家谱用过\r\n              // eslint-disable-next-line no-restricted-syntax\r\n              for (const id of this.usedtable) {\r\n                if (id === user.id) {\r\n                  user.used = true;\r\n                  break;\r\n                } else { user.used = false; }\r\n              }\r\n            }\r\n            console.log(this.userlist);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    outputUsedtable() {\r\n      console.log(this.usedtable);\r\n      console.log(this.userlist);\r\n      console.log(this.tree);\r\n      console.log(this.currentnode);\r\n      console.log(this.currentchildren);\r\n      console.log(this.uppertree);\r\n    },\r\n    customizeName(item) {\r\n      this.$prompt('输入自定义成员名', '自定义成员', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n      }).then(({ value }) => {\r\n        if (value === null) {\r\n          // eslint-disable-next-line\r\n            value = '';\r\n        }\r\n        // eslint-disable-next-line no-param-reassign\r\n        item.defined = true;\r\n        // eslint-disable-next-line no-param-reassign\r\n        item.name = value;\r\n        // eslint-disable-next-line no-param-reassign\r\n        item.image = 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png';\r\n        this.$forceUpdate();\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '取消输入',\r\n        });\r\n      });\r\n      // let q = false;\r\n      // // eslint-disable-next-line no-constant-condition,no-plusplus\r\n      // for (let i = 0; i > 1; --i) {\r\n      //   this.randomnum = Math.round(Math.random() * 100000);\r\n      //   console.log(this.randomnum);\r\n      //   // eslint-disable-next-line no-restricted-syntax,no-plusplus\r\n      //   for (let j = 0; j < this.userlist; ++j) {\r\n      //     if (j === this.userlist.length - 1 && this.randomnum !== this.userlist[j].id) {\r\n      //       q = true;\r\n      //     }\r\n      //   }\r\n      //   if (q === true) {\r\n      //     break;\r\n      //   }\r\n      // }\r\n    },\r\n  },\r\n  created() {\r\n    this.loadGenealogy();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n#app {\r\n  font-family: Avenir, Helvetica, Arial, sans-serif;\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n  color: #2c3e50;\r\n  margin-top: 30px;\r\n}\r\n.text-center {\r\n  text-align: center;\r\n  margin-bottom: 16px;\r\n}\r\n.custom-card {\r\n  display: flex;\r\n  align-items: center;\r\n  min-width: 110px;\r\n  height: 55px;\r\n  padding: 5px;\r\n  border: 0.5px solid #ddd;\r\n  border-radius: 5px;\r\n  box-sizing: border-box;\r\n  background-color: #fff;\r\n  cursor: pointer;\r\n  box-shadow: 0 0 3px 1px rgba(#000, 0);\r\n  transition: box-shadow .2s ease;\r\n  &:hover {\r\n    box-shadow: 0 0 3px 1px rgba(#000, .1);\r\n  }\r\n  &__image {\r\n    flex: 0 0 auto;\r\n    width: 30px;\r\n    height: 30px;\r\n    border-radius: 50%;\r\n    background-color: #dedede;\r\n    background-size: cover;\r\n    background-position: 50%;\r\n  }\r\n  &__info {\r\n    padding-left: 8px;\r\n  }\r\n  &__name {\r\n    font-weight: 300;\r\n  }\r\n  &__age {\r\n    margin-top: 2px;\r\n    font-size: 6px;\r\n  }\r\n}\r\n</style>\r\n"]}]}